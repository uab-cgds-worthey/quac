"""
QuaC pipeline
"""

import pandas as pd

WORKFLOW_PATH = Path(workflow.basedir).parent


configfile: WORKFLOW_PATH / "configs/workflow.yaml"


##############   MODULES   ##############
include: "rules/common.smk"
include: "rules/relatedness_ancestry.smk"
include: "rules/coverage_analysis.smk"
include: "rules/within_species_contamintation.smk"
# include: "rules/aggregate_results.smk"


#########################################


############   CONSTRAINTS   ############
wildcard_constraints:
    sample="|".join(SAMPLES),
    project=PROJECT_NAME,


#########################################


WGS_ONLY_COVERAGE_TARGETS = []
if not not EXOME_MODE:
    WGS_ONLY_COVERAGE_TARGETS = [
     OUT_DIR / "indexcov" / "index.html",
     OUT_DIR / "covviz/" / "covviz_report.html"
    ]


rule all:
    input:
        ## ancestry and relatedness ##
        OUT_DIR / "somalier" / "relatedness" / "somalier.html",
        OUT_DIR / "somalier" / "ancestry" / "somalier.somalier-ancestry.html",
        ## coverage ##
        WGS_ONLY_COVERAGE_TARGETS,
        expand(str(OUT_DIR / "mosdepth" / "results" / "{sample}.mosdepth.global.dist.txt"),
            sample=SAMPLES),
        ## cross-sample contamination ##
        expand(str(OUT_DIR / "analysis" / "{sample}" / "qc" / "verifyBamID" / "{sample}.Ancestry"),
            sample=SAMPLES),
        ## results aggregation ##
        # OUT_DIR / "multiqc/multiqc_report.html",




